<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Proteínas e Carboidratos para Recomposição Corporal</title>

    <!-- Ícone -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='25' fill='%2310b981'/%3E%3Cpath d='M50 20 C75 20 85 40 85 60 C85 85 60 85 50 85 C40 85 15 85 15 60 C15 40 25 20 50 20 Z' fill='white'/%3E%3Cpath d='M50 20 L50 85' stroke='%2310b981' stroke-width='4'/%3E%3C/svg%3E"
    />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Confetti Library -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              display: ["Poppins", "sans-serif"],
            },
            colors: {
              brand: {
                50: "#ecfdf5",
                100: "#d1fae5",
                500: "#10b981",
                600: "#059669",
                900: "#064e3b",
              },
            },
            boxShadow: {
              soft: "0 10px 40px -10px rgba(0,0,0,0.08)",
              "inner-light": "inset 0 2px 4px 0 rgba(255, 255, 255, 0.3)",
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #f8fafc;
        -webkit-tap-highlight-color: transparent;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .checkbox-bounce {
        animation: bounce 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      @keyframes bounce {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
      }
      .liquid-bg {
        background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
        transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .progress-ring__circle {
        transition: stroke-dashoffset 0.5s ease-in-out, stroke 0.3s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }
    </style>
  </head>
  <body class="text-slate-800 pb-12">
    <!-- Top Bar -->
    <div
      class="fixed top-0 w-full z-40 bg-white/80 backdrop-blur-md border-b border-slate-100 transition-all duration-300"
      id="navbar"
    >
      <div class="max-w-md mx-auto px-6 py-4 flex justify-between items-center">
        <div>
          <p
            class="text-xs font-semibold text-slate-400 uppercase tracking-wider"
            id="current-date"
          >
            CARREGANDO...
          </p>
          <h1 class="text-xl font-display font-bold text-slate-800">Hoje</h1>
        </div>
        <!-- Auth Status Indicator -->
        <div
          id="auth-status"
          class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400 font-bold shadow-sm transition-colors duration-500"
        >
          <i class="fas fa-sync fa-spin text-xs"></i>
        </div>
      </div>
    </div>

    <main class="max-w-md mx-auto px-5 mt-24 space-y-6">
      <!-- Dashboard Macros -->
      <section class="grid grid-cols-3 gap-3">
        <!-- PROTEÍNA -->
        <div
          class="bg-white p-4 rounded-2xl shadow-soft flex flex-col items-center justify-center relative overflow-hidden group"
        >
          <svg
            class="w-16 h-16 transform transition-transform group-hover:scale-105"
            viewBox="0 0 100 100"
          >
            <circle
              class="text-slate-100"
              stroke-width="8"
              stroke="currentColor"
              fill="transparent"
              r="42"
              cx="50"
              cy="50"
            />
            <circle
              id="ring-p"
              class="text-brand-500 progress-ring__circle"
              stroke-width="8"
              stroke-linecap="round"
              stroke="currentColor"
              fill="transparent"
              r="42"
              cx="50"
              cy="50"
              stroke-dasharray="263.8"
              stroke-dashoffset="0"
            />
            <foreignObject x="30" y="30" width="40" height="40">
              <div
                class="h-full flex items-center justify-center text-brand-600"
                id="icon-p"
              >
                <i class="fas fa-drumstick-bite text-xl"></i>
              </div>
            </foreignObject>
          </svg>
          <div class="text-center mt-2">
            <span id="val-p" class="block text-sm font-bold text-slate-700"
              >175g</span
            >
            <span
              id="label-p"
              class="text-[10px] text-slate-400 font-semibold uppercase"
              >Restante</span
            >
          </div>
        </div>

        <!-- CARBOIDRATO -->
        <div
          class="bg-white p-4 rounded-2xl shadow-soft flex flex-col items-center justify-center relative overflow-hidden group"
        >
          <svg
            class="w-16 h-16 transform transition-transform group-hover:scale-105"
            viewBox="0 0 100 100"
          >
            <circle
              class="text-slate-100"
              stroke-width="8"
              stroke="currentColor"
              fill="transparent"
              r="42"
              cx="50"
              cy="50"
            />
            <circle
              id="ring-c"
              class="text-amber-400 progress-ring__circle"
              stroke-width="8"
              stroke-linecap="round"
              stroke="currentColor"
              fill="transparent"
              r="42"
              cx="50"
              cy="50"
              stroke-dasharray="263.8"
              stroke-dashoffset="0"
            />
            <foreignObject x="30" y="30" width="40" height="40">
              <div
                class="h-full flex items-center justify-center text-amber-500"
                id="icon-c"
              >
                <i class="fas fa-bread-slice text-xl"></i>
              </div>
            </foreignObject>
          </svg>
          <div class="text-center mt-2">
            <span id="val-c" class="block text-sm font-bold text-slate-700"
              >215g</span
            >
            <span
              id="label-c"
              class="text-[10px] text-slate-400 font-semibold uppercase"
              >Restante</span
            >
          </div>
        </div>

        <!-- GORDURA -->
        <div
          class="bg-white p-4 rounded-2xl shadow-soft flex flex-col items-center justify-center relative overflow-hidden group"
        >
          <svg
            class="w-16 h-16 transform transition-transform group-hover:scale-105"
            viewBox="0 0 100 100"
          >
            <circle
              class="text-slate-100"
              stroke-width="8"
              stroke="currentColor"
              fill="transparent"
              r="42"
              cx="50"
              cy="50"
            />
            <circle
              id="ring-f"
              class="text-blue-400 progress-ring__circle"
              stroke-width="8"
              stroke-linecap="round"
              stroke="currentColor"
              fill="transparent"
              r="42"
              cx="50"
              cy="50"
              stroke-dasharray="263.8"
              stroke-dashoffset="0"
            />
            <foreignObject x="30" y="30" width="40" height="40">
              <div
                class="h-full flex items-center justify-center text-blue-500"
                id="icon-f"
              >
                <i class="fas fa-tint text-xl"></i>
              </div>
            </foreignObject>
          </svg>
          <div class="text-center mt-2">
            <span id="val-f" class="block text-sm font-bold text-slate-700"
              >75g</span
            >
            <span
              id="label-f"
              class="text-[10px] text-slate-400 font-semibold uppercase"
              >Restante</span
            >
          </div>
        </div>
      </section>

      <!-- Water Tracker -->
      <section
        class="bg-white rounded-3xl shadow-soft p-1 overflow-hidden relative"
      >
        <div class="relative z-10 p-5">
          <div class="flex justify-between items-end mb-4">
            <div>
              <h2 class="font-display font-bold text-slate-700 text-lg">
                Hidratação
              </h2>
              <p class="text-xs text-slate-400 font-medium mt-1">
                Meta diária: 4000ml
              </p>
            </div>
            <div class="text-right">
              <span id="water-display" class="text-2xl font-bold text-blue-600"
                >0</span
              >
              <span class="text-sm text-blue-400 font-medium">ml</span>
            </div>
          </div>

          <div
            class="h-6 w-full bg-slate-100 rounded-full overflow-hidden mb-5 relative shadow-inner-light"
          >
            <div
              id="water-bar"
              class="h-full w-0 liquid-bg rounded-full relative"
            >
              <div
                class="absolute top-0 right-0 w-full h-full bg-white opacity-20 animate-pulse"
              ></div>
            </div>
          </div>

          <div class="grid grid-cols-4 gap-2">
            <button
              id="btn-water-250"
              class="col-span-1 py-3 rounded-xl bg-blue-50 text-blue-600 font-bold text-sm hover:bg-blue-100 active:scale-95 transition flex flex-col items-center gap-1 opacity-50 cursor-not-allowed"
            >
              <i class="fas fa-glass-water text-xs"></i> 250
            </button>
            <button
              id="btn-water-500"
              class="col-span-1 py-3 rounded-xl bg-blue-50 text-blue-600 font-bold text-sm hover:bg-blue-100 active:scale-95 transition flex flex-col items-center gap-1 opacity-50 cursor-not-allowed"
            >
              <i class="fas fa-bottle-water text-xs"></i> 500
            </button>
            <button
              id="btn-water-1000"
              class="col-span-1 py-3 rounded-xl bg-blue-50 text-blue-600 font-bold text-sm hover:bg-blue-100 active:scale-95 transition flex flex-col items-center gap-1 opacity-50 cursor-not-allowed"
            >
              <i class="fas fa-jug-detergent text-xs"></i> 1L
            </button>
            <button
              id="btn-water-reset"
              class="col-span-1 py-3 rounded-xl bg-slate-50 text-slate-400 hover:text-red-500 hover:bg-red-50 transition active:scale-95 opacity-50 cursor-not-allowed"
            >
              <i class="fas fa-rotate-left"></i>
            </button>
          </div>
        </div>
      </section>

      <!-- Refeições -->
      <section>
        <div class="flex items-center justify-between mb-4">
          <h2 class="font-display font-bold text-slate-800 text-lg">
            Refeições
          </h2>
          <div
            class="text-xs font-semibold px-3 py-1 bg-slate-100 text-slate-500 rounded-full"
          >
            <span id="completed-meals">0</span>/5 Feitas
          </div>
        </div>

        <div id="meals-container" class="space-y-4">
          <!-- Carregando Skeleton -->
          <div
            class="animate-pulse flex space-x-4 p-5 bg-white rounded-2xl shadow-sm"
          >
            <div class="rounded-full bg-slate-200 h-10 w-10"></div>
            <div class="flex-1 space-y-4 py-1">
              <div class="h-4 bg-slate-200 rounded w-3/4"></div>
              <div class="space-y-2">
                <div class="h-4 bg-slate-200 rounded"></div>
                <div class="h-4 bg-slate-200 rounded w-5/6"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- FIREBASE MODULE -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInWithCustomToken,
        signInAnonymously,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        onSnapshot,
        setDoc,
        getDoc,
        collection,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // --- CONSTANTES DE DADOS ---
      const TOTAL_MACROS = { p: 175, c: 215, f: 75 };
      const GOAL_WATER = 4000;

      const mealsData = [
        {
          id: 1,
          time: "07:30",
          title: "Café da Manhã",
          calories: "Cuscuz + Ovos",
          icon: "fa-mug-hot",
          color: "text-amber-500",
          bg: "bg-amber-50",
          macros: { p: 32, c: 45, f: 22 },
          items: [
            "150g Cuscuz de Milho",
            "4 Ovos Mexidos",
            "Café preto (sem açúcar)",
          ],
        },
        {
          id: 2,
          time: "12:30",
          title: "Almoço",
          calories: "Sólido",
          icon: "fa-bowl-food",
          color: "text-emerald-500",
          bg: "bg-emerald-50",
          macros: { p: 48, c: 60, f: 18 },
          items: [
            "150g Frango/Patinho",
            "150g Arroz",
            "100g Feijão",
            "Salada + Azeite",
          ],
        },
        {
          id: 3,
          time: "16:30",
          title: "Pré-Treino",
          calories: "Energia",
          icon: "fa-bolt",
          color: "text-yellow-500",
          bg: "bg-yellow-50",
          macros: { p: 25, c: 50, f: 15 },
          items: [
            "2 fatias Pão Integral",
            "2 Ovos ou 80g Frango",
            "1 Maçã/Melão",
          ],
        },
        {
          id: 4,
          time: "19:00",
          title: "Pós-Treino",
          calories: "Recuperação",
          icon: "fa-glass-water",
          color: "text-blue-500",
          bg: "bg-blue-50",
          macros: { p: 25, c: 25, f: 1 },
          items: ["30g Whey Protein", "250ml Água Gelada", "1 Banana"],
        },
        {
          id: 5,
          time: "20:30",
          title: "Jantar",
          calories: "Leve",
          icon: "fa-moon",
          color: "text-indigo-500",
          bg: "bg-indigo-50",
          macros: { p: 45, c: 35, f: 19 },
          items: [
            "150g Peixe/Frango",
            "200g Batata/Mandioca",
            "Legumes cozidos",
            "Azeite",
          ],
        },
      ];

      // --- FIREBASE SETUP ---
      const firebaseConfig = JSON.parse(__firebase_config);
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-app-id";

      let currentUser = null;
      let todayKey = ""; // Será setado no init

      // Estado local (sincronizado com DB)
      let appState = {
        water: 0,
        checkedMeals: [],
        date: "",
      };

      // --- INICIALIZAÇÃO ---
      async function init() {
        renderDate();

        // Autenticação
        try {
          if (
            typeof __initial_auth_token !== "undefined" &&
            __initial_auth_token
          ) {
            await signInWithCustomToken(auth, __initial_auth_token);
          } else {
            await signInAnonymously(auth);
          }
        } catch (error) {
          console.error("Auth Error:", error);
        }

        // Observar estado da auth
        onAuthStateChanged(auth, (user) => {
          if (user) {
            currentUser = user;
            updateAuthStatus("connected");
            subscribeToData();
          } else {
            updateAuthStatus("disconnected");
          }
        });

        // Configurar botões (agora que o module carregou)
        setupButtons();
      }

      function updateAuthStatus(status) {
        const indicator = document.getElementById("auth-status");
        if (status === "connected") {
          indicator.innerHTML = '<i class="fas fa-cloud text-xs"></i>';
          indicator.classList.remove("bg-slate-100", "text-slate-400");
          indicator.classList.add("bg-emerald-100", "text-emerald-600");
        } else {
          indicator.innerHTML = '<i class="fas fa-wifi-slash text-xs"></i>';
          indicator.classList.add("bg-slate-100", "text-slate-400");
          indicator.classList.remove("bg-emerald-100", "text-emerald-600");
        }
      }

      // --- DATA LAYER (FIRESTORE) ---
      function subscribeToData() {
        if (!currentUser) return;

        // Caminho: artifacts/{appId}/users/{uid}/daily_stats/{todayKey}
        const docRef = doc(
          db,
          "artifacts",
          appId,
          "users",
          currentUser.uid,
          "daily_stats",
          todayKey
        );

        // Listener em tempo real
        onSnapshot(
          docRef,
          (docSnap) => {
            enableControls();

            if (docSnap.exists()) {
              appState = docSnap.data();
            } else {
              // Documento não existe (dia novo ou primeiro acesso)
              appState = {
                water: 0,
                checkedMeals: [],
                date: todayKey,
              };
              // Cria o documento inicial no DB
              saveData();
            }

            // Atualiza toda a UI com os novos dados
            updateWaterUI();
            renderMeals();
            updateMacrosUI();
          },
          (error) => {
            console.error("Erro ao sincronizar dados:", error);
          }
        );
      }

      async function saveData() {
        if (!currentUser) return;
        const docRef = doc(
          db,
          "artifacts",
          appId,
          "users",
          currentUser.uid,
          "daily_stats",
          todayKey
        );

        // Usando setDoc com merge para segurança, mas sobrescrevendo estado local
        await setDoc(docRef, appState, { merge: true });
      }

      // --- LÓGICA DE UI ---
      function renderDate() {
        const options = { weekday: "long", day: "numeric", month: "long" };
        const dateObj = new Date();
        const dateStr = dateObj.toLocaleDateString("pt-BR", options);
        document.getElementById("current-date").innerText = dateStr;

        // Key para o DB (ex: "Tue Oct 27 2023" - sem acentos, simples)
        todayKey = dateObj.toDateString();
      }

      function enableControls() {
        // Habilita botões que começam desabilitados
        const buttons = document.querySelectorAll("button");
        buttons.forEach((btn) => {
          btn.classList.remove("opacity-50", "cursor-not-allowed");
          btn.disabled = false;
        });
      }

      // --- ACTIONS (ÁGUA) ---
      window.handleWater = (amount) => {
        if (amount === 0) {
          if (confirm("Zerar contador de água?")) {
            appState.water = 0;
            saveData();
          }
        } else {
          appState.water += amount;
          if (appState.water > GOAL_WATER + 1000)
            appState.water = GOAL_WATER + 1000;

          if (
            appState.water >= GOAL_WATER &&
            appState.water - amount < GOAL_WATER
          ) {
            triggerConfetti();
          }
          saveData();
        }
      };

      function updateWaterUI() {
        const display = document.getElementById("water-display");
        const bar = document.getElementById("water-bar");

        display.innerText = appState.water;

        const percentage = Math.min((appState.water / GOAL_WATER) * 100, 100);
        bar.style.height = "100%";
        bar.style.width = `${percentage}%`;

        if (appState.water >= GOAL_WATER) {
          bar.classList.remove("liquid-bg");
          bar.classList.add("bg-emerald-500");
        } else {
          bar.classList.add("liquid-bg");
          bar.classList.remove("bg-emerald-500");
        }
      }

      // --- ACTIONS (REFEIÇÕES) ---
      window.toggleMeal = (id) => {
        if (appState.checkedMeals.includes(id)) {
          appState.checkedMeals = appState.checkedMeals.filter(
            (mid) => mid !== id
          );
        } else {
          appState.checkedMeals.push(id);
          if (navigator.vibrate) navigator.vibrate(50);

          if (appState.checkedMeals.length === mealsData.length) {
            triggerConfetti();
          }
        }
        saveData();
        // A UI atualiza automaticamente pelo onSnapshot,
        // mas podemos forçar para resposta instantânea
        // renderMeals();
        // updateMacrosUI();
      };

      function renderMeals() {
        const container = document.getElementById("meals-container");
        container.innerHTML = "";
        let completedCount = 0;

        mealsData.forEach((meal) => {
          const isChecked = appState.checkedMeals.includes(meal.id);
          if (isChecked) completedCount++;

          const opacityClass = isChecked
            ? "opacity-60 grayscale"
            : "opacity-100";
          const bgClass = isChecked ? "bg-slate-50" : "bg-white";

          const html = `
                    <div class="relative overflow-hidden rounded-2xl border border-slate-100 shadow-soft transition-all duration-300 ${opacityClass} ${bgClass}">
                        <label class="block p-5 cursor-pointer relative z-10">
                            <div class="flex items-start gap-4">
                                <div class="relative pt-1">
                                    <input type="checkbox" class="peer sr-only" 
                                        onchange="toggleMeal(${meal.id})" 
                                        ${isChecked ? "checked" : ""}>
                                    <div class="w-6 h-6 rounded-full border-2 border-slate-300 peer-checked:bg-emerald-500 peer-checked:border-emerald-500 transition-colors flex items-center justify-center checkbox-bounce">
                                        <i class="fas fa-check text-white text-xs ${
                                          isChecked ? "block" : "hidden"
                                        }"></i>
                                    </div>
                                </div>

                                <div class="flex-1">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <span class="text-xs font-bold text-slate-400 tracking-wider">${
                                              meal.time
                                            }</span>
                                            <h3 class="font-display font-bold text-slate-800 text-lg ${
                                              isChecked
                                                ? "line-through text-slate-400"
                                                : ""
                                            }">${meal.title}</h3>
                                        </div>
                                        <div class="w-8 h-8 rounded-full ${
                                          meal.bg
                                        } flex items-center justify-center ${
            meal.color
          }">
                                            <i class="fas ${meal.icon}"></i>
                                        </div>
                                    </div>

                                    <div class="mt-3 space-y-1">
                                        ${meal.items
                                          .map(
                                            (item) => `
                                            <div class="flex items-center gap-2 text-sm text-slate-600">
                                                <div class="w-1 h-1 rounded-full bg-slate-300"></div>
                                                ${item}
                                            </div>
                                        `
                                          )
                                          .join("")}
                                    </div>
                                    
                                    <div class="mt-3 pt-3 border-t border-slate-100 flex gap-3 text-[10px] text-slate-400 uppercase font-bold">
                                        <span>P: ${meal.macros.p}g</span>
                                        <span>C: ${meal.macros.c}g</span>
                                        <span>G: ${meal.macros.f}g</span>
                                    </div>
                                </div>
                            </div>
                        </label>
                    </div>
                `;
          container.innerHTML += html;
        });

        document.getElementById("completed-meals").innerText = completedCount;
      }

      // --- MACROS ---
      function updateMacrosUI() {
        let consumed = { p: 0, c: 0, f: 0 };

        appState.checkedMeals.forEach((mealId) => {
          const meal = mealsData.find((m) => m.id === mealId);
          if (meal) {
            consumed.p += meal.macros.p;
            consumed.c += meal.macros.c;
            consumed.f += meal.macros.f;
          }
        });

        const remaining = {
          p: TOTAL_MACROS.p - consumed.p,
          c: TOTAL_MACROS.c - consumed.c,
          f: TOTAL_MACROS.f - consumed.f,
        };

        updateSingleMacro("p", remaining.p, TOTAL_MACROS.p);
        updateSingleMacro("c", remaining.c, TOTAL_MACROS.c);
        updateSingleMacro("f", remaining.f, TOTAL_MACROS.f);
      }

      function updateSingleMacro(type, remainingVal, totalVal) {
        const elVal = document.getElementById(`val-${type}`);
        const elLabel = document.getElementById(`label-${type}`);
        const elRing = document.getElementById(`ring-${type}`);
        const elIcon = document.getElementById(`icon-${type}`);

        const displayVal = remainingVal <= 0 ? 0 : remainingVal;
        elVal.innerText = `${displayVal}g`;

        if (remainingVal <= 0) {
          elLabel.innerText = "CONCLUÍDO!";
          elLabel.className =
            "text-[10px] font-bold text-emerald-600 uppercase";
          elVal.className = "block text-sm font-bold text-emerald-600";

          elRing.style.strokeDashoffset = "0";
          elRing.classList.remove(
            "text-brand-500",
            "text-amber-400",
            "text-blue-400"
          );
          elRing.classList.add("text-emerald-500");

          elIcon.classList.remove(
            "text-brand-600",
            "text-amber-500",
            "text-blue-500"
          );
          elIcon.classList.add("text-emerald-600");
        } else {
          elLabel.innerText = "RESTANTE";
          elLabel.className =
            "text-[10px] text-slate-400 font-semibold uppercase";
          elVal.className = "block text-sm font-bold text-slate-700";

          const circumference = 263.8;
          const percentRemaining = remainingVal / totalVal;
          const percentConsumed = 1 - percentRemaining;
          const offset = circumference - percentConsumed * circumference;

          elRing.style.strokeDashoffset = offset;

          if (type === "p") {
            elRing.classList.remove("text-emerald-500");
            elRing.classList.add("text-brand-500");
            elIcon.classList.remove("text-emerald-600");
            elIcon.classList.add("text-brand-600");
          } else if (type === "c") {
            elRing.classList.remove("text-emerald-500");
            elRing.classList.add("text-amber-400");
            elIcon.classList.remove("text-emerald-600");
            elIcon.classList.add("text-amber-500");
          } else if (type === "f") {
            elRing.classList.remove("text-emerald-500");
            elRing.classList.add("text-blue-400");
            elIcon.classList.remove("text-emerald-600");
            elIcon.classList.add("text-blue-500");
          }
        }
      }

      function triggerConfetti() {
        var count = 200;
        var defaults = { origin: { y: 0.7 } };
        function fire(particleRatio, opts) {
          confetti(
            Object.assign({}, defaults, opts, {
              particleCount: Math.floor(count * particleRatio),
            })
          );
        }
        fire(0.25, { spread: 26, startVelocity: 55 });
        fire(0.2, { spread: 60 });
        fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
      }

      // Bridge para o HTML (onClick)
      function setupButtons() {
        document.getElementById("btn-water-250").onclick = () =>
          window.handleWater(250);
        document.getElementById("btn-water-500").onclick = () =>
          window.handleWater(500);
        document.getElementById("btn-water-1000").onclick = () =>
          window.handleWater(1000);
        document.getElementById("btn-water-reset").onclick = () =>
          window.handleWater(0);
      }

      // START
      init();
    </script>
  </body>
</html>
